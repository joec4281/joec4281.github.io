<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>.BIN Files In Turbo C</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
body {
 margin: 5px 5px 5px 5px;
 background-color: #ffffff;
}
/* ========== Text Styles ========== */
hr { color: #000000}
body, table, span.rvts0 /* Normal text */
{
 font-size: 10pt;
 font-family: 'Arial', 'Helvetica', sans-serif;
 font-style: normal;
 font-weight: normal;
 color: #000000;
 text-decoration: none;
}
span.rvts1 /* Heading */
{
 font-weight: bold;
 color: #0000ff;
}
span.rvts2 /* Subheading */
{
 font-weight: bold;
 color: #000080;
}
span.rvts3 /* Keywords */
{
 font-style: italic;
 color: #800000;
}
a.rvts4, span.rvts4 /* Jump 1 */
{
 color: #008000;
 text-decoration: underline;
}
a.rvts5, span.rvts5 /* Jump 2 */
{
 color: #008000;
 text-decoration: underline;
}
span.rvts6
{
 font-size: 16pt;
 font-family: 'Courier New', 'Courier', monospace;
}
a.rvts7, span.rvts7
{
 font-size: 16pt;
 font-family: 'Courier New', 'Courier', monospace;
 color: #0000ff;
 text-decoration: underline;
}
/* ========== Para Styles ========== */
p,ul,ol /* Paragraph Style */
{
 text-align: left;
 text-indent: 0px;
 padding: 0px 0px 0px 0px;
 margin: 0px 0px 0px 0px;
}
.rvps1 /* Centered */
{
 text-align: center;
}
--></style>
</head>
<body>
<p><span class=rvts6>For quite some time, I've been writing .BIN files to extend the interpreted dBASE environment. Recently, I came across an extremely simple technique for writing .BINs in Turbo C.</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>Most compiled C routines depend on a start-up module supplied by the compiler vendor. This module sets up the C environment, examines the command line arguments, sets up system global variables, and generally prepares things prior to passing execution to your C program.</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>Some programs, such as dBASE .BIN files, don't need all of this overhead. Moreover, the interface requirements for .BIN files make the use of the standard C startup modules impossible.</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>After I had rewritten the start-up code for Turbo C in assembly language different ways, Len Zerman (now with Nantucket) showed me how to use Turbo C's pseudo-register variables to set up a tiny-model C .BIN routine without any assembly start-up code.</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>This encouraged me to experiment. I found that by using Turbo's compact memory model you can easily link-in many of the Turbo C runtime library routines. Since the compact model library code makes no assumptions about the relationship of the SS and DS registers, a .BIN routine can use the dBASE interpreter's large stack space freely, which keeps the size of the .BIN routine to a minimum. (Tiny-model .BINs have to maintain their own stack within the .BIN routine.)</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>Figure 1 shows a sample .BIN routine written in Turbo C that takes only one parameter, a character string, and reverses it using the Turbo C library routine strrev(). Since STRREV.BIN uses the dBASE III Plus parameter-passing convention (the DS:BX register pair point to the passed parameter), it can be used from dBASE III Plus, dBASE IV, FoxBASE Plus, ForPro, Quicksilver, dBXL, and any other dBASE-like environment that supports the dBASE III Plus conventions for .BIN routines. Since the compact model defaults to far data addresses, all that's necessary to reference the dBASE string is to declare a far pointer and load it with the macro MK_FP(). The pointer can then be passed to the strrev() library routine.</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>There are limits to this approach: no memory can be allocated at runtime except on the dBASE stack, and any library routines that reference globals declared in the Turbo start-up code have to be dealt with as special cases. But I find Turbo C's library routines for string manipulation to be free of these contstraints, and I no longer have to reinvent the wheel every time I need to juggle some charagers around. The size and speed of the resultant .BINs competes with anything I have written in assembly language. (STRREV.BIN is only 86 bytes!)</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>Maybe the biggest limitation of this approach is that if you need to reference static data, you have to get Turbo C to group the data and code segments together as they are in a tiny model. Otherwise, references to data in Turbo C's _DATA segment will not work within the .BIN module.</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>A little experimentation showed that combining the data and code segments in a compact-model .BIN is as simple as inserting these two lines at the top of the C code:</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>asm DGROUP GROUP _DATA,_BSS,_TEXT</span></p>
<p><span class=rvts6>asm ASSUME CS:DGROUP,DS:DGROUP</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>The C compiler warns you that these commands make no sense to it, but it passes them on to TASM (Turbo Assembler), which is all we need. What we have essentially done is to create a mixed-model .BIN routine. This enables us to use the Turbo C's compact-model library and dBASE's copious stack space, without losing the advantages of tiny-model .BIN architecture.</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>With dBASE IV, .BINs become much more powerful. You can pass up to seven parameters to a .BIN. They can be used in index expressions, calculated-field expressions, and even reports and queries.</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>The listing in Figure 2, for RAT.BIN, uses the dBASE IV extensions to the .BIN interface to provide a function like dBASE's AT(), only it finds the last occurence of a substring within a string instead of the first.</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>/* STRREV.C</span></p>
<p><span class=rvts6>&nbsp; &nbsp;STRREV.BIN source, compile/link with:</span></p>
<p><span class=rvts6>&nbsp; &nbsp;TCC -mc -c strrev &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : memory model MUST BE compact,</span></p>
<p><span class=rvts6>&nbsp; &nbsp;TLINK /i strrev,,,D:\TC\LIB\CC &nbsp; &nbsp;: data is far, use DBIV's stack</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: assuming CC.LIB is in D:\TC\LIB\</span></p>
<p><span class=rvts6>&nbsp; &nbsp;EXE2BIN strrev &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: creates STRREV.BIN</span></p>
<p><span class=rvts6>&nbsp; &nbsp;DEL strrev.obj</span></p>
<p><span class=rvts6>&nbsp; &nbsp;DEL strrev.exe</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp;to use from dBASE:</span></p>
<p><span class=rvts6>&nbsp; &nbsp;.LOAD strrev</span></p>
<p><span class=rvts6>&nbsp; &nbsp;.m="whatever"</span></p>
<p><span class=rvts6>&nbsp; &nbsp;.CALL strrev WITH m</span></p>
<p><span class=rvts6>&nbsp; &nbsp;. m will be reversed</span></p>
<p><span class=rvts6>*/</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>#include &lt;dos.h&gt; &nbsp; &nbsp; /* for MK_FP() */</span></p>
<p><span class=rvts6>#include &lt;string.h&gt;</span></p>
<p><span class=rvts6>void far main(void)</span></p>
<p><span class=rvts6>{</span></p>
<p><span class=rvts6>&nbsp; char *param; &nbsp; &nbsp; &nbsp; /* compact model forces *far* */</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; if (_DS == 0) &nbsp; &nbsp; &nbsp;/* if no parameters passed */</span></p>
<p><span class=rvts6>&nbsp; &nbsp; return; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/* return */</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; param = MK_FP(_DS,_BX); &nbsp;/* address the passed parameter */</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; strrev(param); &nbsp; &nbsp; /* call library routine */</span></p>
<p><span class=rvts6>&nbsp; return;</span></p>
<p><span class=rvts6>}</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>/* RAT.C</span></p>
<p><span class=rvts6>&nbsp; &nbsp;RAT.BIN source, compile/link with:</span></p>
<p><span class=rvts6>&nbsp; &nbsp;TCC -mc -c rat &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : memory model MUST BE compact,</span></p>
<p><span class=rvts6>&nbsp; &nbsp;TLINK /l rat,,,D:\TC\LIB\CC &nbsp; &nbsp;: data is far, use dBIV's stack</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : assuming CC.LIB is in D:\TC\LIB\</span></p>
<p><span class=rvts6>&nbsp; &nbsp;EXE2BIN rat &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: creates RAT.BIN</span></p>
<p><span class=rvts6>&nbsp; &nbsp;DEL rat.obj</span></p>
<p><span class=rvts6>&nbsp; &nbsp;DEL rat.exe</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp;to use from dBASE IV only(!):</span></p>
<p><span class=rvts6>&nbsp; &nbsp;.LOAD rat</span></p>
<p><span class=rvts6>&nbsp; &nbsp;.srchstr = "the quick sly fox jumped over the..."</span></p>
<p><span class=rvts6>&nbsp; &nbsp;.position = CALL("rat",0,srchstr,"the")</span></p>
<p><span class=rvts6>&nbsp; &nbsp;* now position = 31</span></p>
<p><span class=rvts6>&nbsp; &nbsp;* All parameters can be fields, expressions, memvars, or literals.</span></p>
<p><span class=rvts6>&nbsp; &nbsp;* The numeric parameter MUST be numeric and the last two MUST be</span></p>
<p><span class=rvts6>&nbsp; &nbsp;* strings.</span></p>
<p><span class=rvts6>*/</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>#include &lt;dos.h&gt;</span></p>
<p><span class=rvts6>#include &lt;string.h&gt;</span></p>
<p><span class=rvts6>#include &lt;stdlib.h&gt;</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>short rat(char *s,char * f);</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>void far main(void)</span></p>
<p><span class=rvts6>{</span></p>
<p><span class=rvts6>&nbsp; char **argv;</span></p>
<p><span class=rvts6>&nbsp; short retval;</span></p>
<p><span class=rvts6><br></span></p>
<p><a class=rvts7 href="https://books.google.ca/books?id=aAtUrtU87kQC&amp;pg=PT406&amp;dq=pc+magazine+strrev+dbase&amp;hl=en&amp;sa=X&amp;ei=ES4QVbWUI42uyAT8jICYBw&amp;redir_esc=y#v=onepage&amp;q=pc%20magazine%20strrev%20dbase&amp;f=true">https://books.google.ca/books?id=aAtUrtU87kQC&amp;pg=PT406&amp;dq=pc+magazine+strrev+dbase&amp;hl=en&amp;sa=X&amp;ei=ES4QVbWUI42uyAT8jICYBw&amp;redir_esc=y#v=onepage&amp;q=pc%20magazine%20strrev%20dbase&amp;f=true</a></p>
<p><span class=rvts6><br></span></p>
</body></html>
