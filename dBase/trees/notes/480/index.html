<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><title>CharStrp</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="Content-Style-Type" content="text/css">
<style type="text/css"><!--
body {
 margin: 5px 5px 5px 5px;
 background-color: #ffffff;
}
/* ========== Text Styles ========== */
hr { color: #000000}
body, table, span.rvts0 /* Normal text */
{
 font-size: 10pt;
 font-family: 'Arial', 'Helvetica', sans-serif;
 font-style: normal;
 font-weight: normal;
 color: #000000;
 text-decoration: none;
}
span.rvts1 /* Heading */
{
 font-weight: bold;
 color: #0000ff;
}
span.rvts2 /* Subheading */
{
 font-weight: bold;
 color: #000080;
}
span.rvts3 /* Keywords */
{
 font-style: italic;
 color: #800000;
}
a.rvts4, span.rvts4 /* Jump 1 */
{
 color: #008000;
 text-decoration: underline;
}
a.rvts5, span.rvts5 /* Jump 2 */
{
 color: #008000;
 text-decoration: underline;
}
span.rvts6
{
 font-size: 16pt;
 font-family: 'Courier New', 'Courier', monospace;
}
/* ========== Para Styles ========== */
p,ul,ol /* Paragraph Style */
{
 text-align: left;
 text-indent: 0px;
 padding: 0px 0px 0px 0px;
 margin: 0px 0px 0px 0px;
}
.rvps1 /* Centered */
{
 text-align: center;
}
--></style>
</head>
<body style="background-color:#FFFFFF;" >
<p><span class=rvts6>PROCEDURE CharStrp</span></p>
<p><span class=rvts6>*-----------------------------------------------------------------------</span></p>
<p><span class=rvts6>*-- Programmer..: David Love (CIS: 71333,121)</span></p>
<p><span class=rvts6>*-- Date........: 09/06/1994</span></p>
<p><span class=rvts6>*-- Notes.......: To remove or replace characters in a file. &nbsp;Good for</span></p>
<p><span class=rvts6>*-- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; removing unwanted unprintable characters.</span></p>
<p><span class=rvts6>*-- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Works better if SET TALK is OFF.</span></p>
<p><span class=rvts6>*-- Written for.: dBASE IV ver 1.5 and later</span></p>
<p><span class=rvts6>*-- Rev. History: 09/06/1994 -- Original</span></p>
<p><span class=rvts6>*-- Calls.......: None</span></p>
<p><span class=rvts6>*-- Called by...: Any</span></p>
<p><span class=rvts6>*-- Usage.......: do CharStrp with cExp1, cExp2, cExp3, cExp4</span></p>
<p><span class=rvts6>*-- Example.....: do CharStrp with "SrceFile.TXT","TargFile.TXT",;</span></p>
<p><span class=rvts6>*-- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;chr(10)+chr(13)+chr(10),;</span></p>
<p><span class=rvts6>*-- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;' '+chr(13)+chr(10)</span></p>
<p><span class=rvts6>*-- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; (This example replaces all occurrences of&nbsp;</span></p>
<p><span class=rvts6>*-- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;LF/CR/LF in file SrceFile.TXT with a space</span></p>
<p><span class=rvts6>*-- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;followed by CR/LF in the output file: TargFile.TXT.</span></p>
<p><span class=rvts6>*-- Returns.....: None</span></p>
<p><span class=rvts6>*-- Parameters..: cSFile &nbsp; = Source file being read</span></p>
<p><span class=rvts6>*-- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cTFile &nbsp; = Target file to be written</span></p>
<p><span class=rvts6>*-- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cSString = Source string (being searched for in</span></p>
<p><span class=rvts6>*-- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;source file.</span></p>
<p><span class=rvts6>*-- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cRString = Replacement string (written to target file)</span></p>
<p><span class=rvts6>*-----------------------------------------------------------------------</span></p>
<p><span class=rvts6>&nbsp; &nbsp;parameters cSFile, cTFile, cSString, cRString</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp;*-- source file</span></p>
<p><span class=rvts6>&nbsp; &nbsp;do case</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; case pcount() &lt;= 2</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;return</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; case pcount() = 3</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cRString = ""</span></p>
<p><span class=rvts6>&nbsp; &nbsp;endcase</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp;if .not. file( m-&gt;cSFile )</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; return</span></p>
<p><span class=rvts6>&nbsp; &nbsp;endif</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp;private nSize, nSrcFile, nTargFile, cReadStr, Junk, nBytesRead, ;</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nBytesLeft, nRead</span></p>
<p><span class=rvts6>&nbsp; &nbsp;nSize = fsize( m-&gt;cSFile )</span></p>
<p><span class=rvts6>&nbsp; &nbsp;nSrcFile = fopen( m-&gt;cSFile, 'r')</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp;*-- target file</span></p>
<p><span class=rvts6>&nbsp; &nbsp;if file( m-&gt;cTFile )</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; erase ( m-&gt;cTFile )</span></p>
<p><span class=rvts6>&nbsp; &nbsp;endif</span></p>
<p><span class=rvts6>&nbsp; &nbsp;nTargFile = fcreate( m-&gt;cTFile, 'w')</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp;*-- read the file, maximum 254 bytes at a time</span></p>
<p><span class=rvts6>&nbsp; &nbsp;*-- track number bytes read</span></p>
<p><span class=rvts6>&nbsp; &nbsp;nBytesRead = 0</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp;*-- track number bytes left to read</span></p>
<p><span class=rvts6>&nbsp; &nbsp;nBytesLeft = m-&gt;nSize - m-&gt;nBytesRead</span></p>
<p><span class=rvts6>&nbsp; &nbsp;do while .not. feof( m-&gt;nSrcFile )</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; *-- nRead is number of bytes to read</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; if m-&gt;nBytesLeft &lt; &nbsp;254</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nRead = m-&gt;nBytesLeft</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; else</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;nRead = 254</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; endif</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; *-- Read into cReadStr</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; cReadStr = fread( m-&gt;nSrcFile, m-&gt;nRead )</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; *-- Test for break in search string across reads</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; *-- &nbsp; if length of search string &gt; 1 &nbsp;(otherwise, won't break</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; *-- &nbsp; across reads)</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; if len( m-&gt;cSString ) &gt; 1</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*-- get right-most character and test for one of the search&nbsp;</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*-- characters</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cRight = right( m-&gt;cReadStr, 1 )</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;do while m-&gt;cRight $ m-&gt;cSString</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *-- Take the right-most character off and retest</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cReadStr = left( m-&gt;cReadStr, len(m-&gt;cReadStr) - 1 )</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cRight = right( m-&gt;cReadStr, 1 )</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;enddo</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*-- If the right-most character was one of the search characters</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;*-- &nbsp; the length of the string will not equal the original length</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;if len( m-&gt;cReadStr ) # m-&gt;nRead</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *-- Back file pointer up to where started from</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Junk = fseek( m-&gt;nSrcFile, -1 * (m-&gt;nRead), 1 )</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; nRead = len( m-&gt;cReadStr )</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *-- Read enough not to get the last character prior to</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; *-- &nbsp; character in search string</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cReadStr = fread( m-&gt;nSrcFile, m-&gt;nRead )</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;endif</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; endif</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; nBytesRead = m-&gt;nBytesRead + m-&gt;nRead</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; nBytesLeft = m-&gt;nSize - m-&gt;nBytesRead</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; *-- replace all cSString with cRString</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; do while at( m-&gt;cSString, m-&gt;cReadStr ) # 0</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cReadStr = stuff( m-&gt;cReadStr, ;</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;at( m-&gt;cSString, m-&gt;cReadStr ), ;</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;len( m-&gt;cSString ), m-&gt;cRString )</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; enddo</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; *-- write to the target file</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; Junk = fwrite( m-&gt;nTargFile, m-&gt;cReadStr )</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; *-- if the last character(s) are equal to the search string,</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; *-- &nbsp; or fewer characters than in search string,</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; *-- &nbsp; need to read and write; then will be at feof().</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; if m-&gt;nBytesLeft &lt;= len( m-&gt;cSString )</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;cReadStr = fread( m-&gt;nSrcFile, m-&gt;nBytesLeft )</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;do while at( m-&gt;cSString, m-&gt;cReadStr ) # 0</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; cReadStr = stuff( m-&gt;cReadStr, ;</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; at( m-&gt;cSString, m-&gt;cReadStr ), ;</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; len( m-&gt;cSString ), m-&gt;cRString )</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;enddo</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Junk = fwrite( m-&gt;nTargFile, m-&gt;cReadStr )</span></p>
<p><span class=rvts6>&nbsp; &nbsp; &nbsp; endif</span></p>
<p><span class=rvts6>&nbsp; &nbsp;enddo</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>&nbsp; &nbsp;*-- close up and go home</span></p>
<p><span class=rvts6>&nbsp; &nbsp;Junk = fclose( nSrcFile )</span></p>
<p><span class=rvts6>&nbsp; &nbsp;Junk = fclose( nTargFile )</span></p>
<p><span class=rvts6><br></span></p>
<p><span class=rvts6>RETURN</span></p>
<p><span class=rvts6>*-- EOP: &nbsp;CharStrp</span></p>
<p><span class=rvts6><br></span></p>
</body></html>
